"use strict";var PDS_App;(function(){PDS_AppRun=function(){var t=function(t,i,r){var u,f,e;if(PDS_RunModelViewLessApp(),PDS_GroupsToUpdate=[],PDS_TargetsToUpdate=[],f=function(t,i){var r=n.CryptoJS.enc.Base64.parse(i),f=n.CryptoJS.enc.Base64.parse(n.GLOBAL_IV.replace(/\$/g,"="));return u=n.GLOBAL_IV.replace(/\$/g,"="),n.CryptoJS.AES.encrypt(t,r,{iv:f}).toString()},e=function(t,i,r){var u=n.CryptoJS.enc.Base64.parse(i),f=n.CryptoJS.enc.Base64.parse(r);return n.CryptoJS.AES.decrypt(t,u,{iv:f}).toString(n.CryptoJS.enc.Utf8)},$.isEmptyObject(PDS_ViewDataModel[0])||localStorage["memoryVersion"+r+i]==PDS_ViewDataModel[0].v){if($.isEmptyObject(PDS_ViewDataModel[0])||PDS_ViewDataModel[0].v!="0"){var o=t.transaction("appMemory","readwrite"),s=o.objectStore("appMemory"),h=s.get(1);h.onsuccess=function(n){if(typeof n.target.result=="undefined")alert("Error - no data in index DB (1)");else{var i=JSON.parse(n.target.result).s,r=JSON.parse(n.target.result).o,t=e(r,sessionStorage.sepk,i);t!==""&&(PDS_ViewDataModel[0].t=JSON.parse(t),PDS_RunViewModelMemoryApp())}}}}else{var c=f(JSON.stringify(PDS_ViewDataModel[0].t),sessionStorage.sepk),l='{"s":"'+u+'","o":"'+c+'"}',a=t.transaction("appMemory","readwrite"),v=a.objectStore("appMemory"),y=v.put(l,1);y.onsuccess=function(){localStorage["memoryVersion"+r+i]=PDS_ViewDataModel[0].v;PDS_RunViewModelMemoryApp()}}if($.isEmptyObject(PDS_ViewDataModel[1])||PDS_ViewDataModel[1][i+"_"+r].length>0)if($.isEmptyObject(PDS_ViewDataModel[1])||PDS_ViewDataModel[1].vm==localStorage["targetVersion"+r+i]){var o=t.transaction("appTarget","readwrite"),s=o.objectStore("appTarget"),h=s.get(1);h.onsuccess=function(n){if(typeof n.target.result=="undefined")alert("Error - no data in index DB (2)");else{var u=JSON.parse(n.target.result).s,f=JSON.parse(n.target.result).o,t=e(f,sessionStorage.sepk,u);t!==""&&(PDS_ViewDataModel[1][i+"_"+r]=JSON.parse(t),PDS_RunViewModelTargetApp())}}}else{var c=f(JSON.stringify(PDS_ViewDataModel[1][i+"_"+r]),sessionStorage.sepk),l='{"s":"'+u+'","o":"'+c+'"}',a=t.transaction("appTarget","readwrite"),v=a.objectStore("appTarget"),y=v.put(l,1);y.onsuccess=function(){localStorage["targetVersion"+r+i]=PDS_ViewDataModel[1].vm;PDS_RunViewModelTargetApp()}}if($.isEmptyObject(PDS_ViewDataModel[2])&&localStorage["groupVersion"+r+i]!="0"){var o=t.transaction("appGroup","readwrite"),s=o.objectStore("appGroup"),h=s.get(1);h.onsuccess=function(n){if(typeof n.target.result=="undefined")alert("Error - no data in index DB (3)");else{var i=JSON.parse(n.target.result).s,r=JSON.parse(n.target.result).o,t=e(r,sessionStorage.sepk,i);t!==""&&(PDS_ViewDataModel[2].t=JSON.parse(t),PDS_RunViewModelGroupApp())}}}if(!$.isEmptyObject(PDS_ViewDataModel[2])){var o=t.transaction("appGroup","readwrite"),s=o.objectStore("appGroup"),h=s.get(1);h.onsuccess=function(n){var l,s,c,o,a,h;if(typeof n.target.result=="undefined"){var v=f(JSON.stringify(PDS_ViewDataModel[2].t),sessionStorage.sepk),y='{"s":"'+u+'","o":"'+v+'"}',p=t.transaction("appGroup","readwrite"),w=p.objectStore("appGroup"),b=w.put(y,1);b.onsuccess=function(){localStorage["groupVersion"+r+i]=PDS_ViewDataModel[2].v;PDS_RunViewModelGroupApp()}}else{var d=JSON.parse(n.target.result).s,g=JSON.parse(n.target.result).o,k=e(g,sessionStorage.sepk,d);if(k!==""){for(l=JSON.parse(k),s=PDS_ViewDataModel[2].t,PDS_ViewDataModel[2].t=[],c=l.length-1;c>=0;c--)PDS_ViewDataModel[2].t.push(l[c]);for(o=s.length-1;o>=0;o--){for(a="0",h=PDS_ViewDataModel[2].t.length-1;h>=0;h--)PDS_ViewDataModel[2].t[h].k===s[o].k&&(PDS_ViewDataModel[2].t[h].d=s[o].d,a="1");a=="0"&&PDS_ViewDataModel[2].t.push(s[o])}var v=f(JSON.stringify(PDS_ViewDataModel[2].t),sessionStorage.sepk),y='{"s":"'+u+'","o":"'+v+'"}',p=t.transaction("appGroup","readwrite"),w=p.objectStore("appGroup"),b=w.put(y,1);b.onsuccess=function(){localStorage["groupVersion"+r+i]=PDS_ViewDataModel[2].v;PDS_RunViewModelGroupApp()}}}}}PDS_FinishTransaction()},i=function(){function s(){return typeof PDS_ViewDataModel.error=="undefined"?!1:!0}var i,f,o,e,u,r;PDS_CreateSampleGroupAndTarget=function(){PDS_TargetsToUpdate=[{k:PDS_GetMessagePipe().$$.Tool.GenerateGuid(),t:{someObj:"0"}}];PDS_GroupsToUpdate=[{k:PDS_GetMessagePipe().$$.Tool.GenerateGuid(),d:{value:"0"}}]};PDS_GetMessagePipe=function(){return document.getElementById(PDS_PipeName).contentWindow};PDS_RunDecryptFunction=function(t,i){var r=n.CryptoJS.enc.Base64.parse(i),u=n.CryptoJS.enc.Base64.parse(n.GLOBAL_IV.replace(/\$/g,"="));return n.CryptoJS.AES.decrypt(t,r,{iv:u}).toString(n.CryptoJS.enc.Utf8)};PDS_RunEncryptFunction=function(t,i){var r=n.CryptoJS.enc.Base64.parse(i),u=n.CryptoJS.enc.Base64.parse(n.GLOBAL_IV.replace(/\$/g,"="));return n.CryptoJS.AES.encrypt(t,r,{iv:u}).toString()};i=new n.jsSHA(new n.jsSHA(sessionStorage.userId,"ASCII").getHash("SHA-256","HEX"),"ASCII").getHash("SHA-256","HEX");PDS_SIGNATURE=i;f=function(t,i){var r=n.CryptoJS.enc.Base64.parse(i),u=n.CryptoJS.enc.Base64.parse(n.GLOBAL_IV.replace(/\$/g,"="));return n.CryptoJS.AES.decrypt(t,r,{iv:u}).toString(n.CryptoJS.enc.Utf8)};o=function(t,i){var r=n.CryptoJS.enc.Base64.parse(i),u=n.CryptoJS.enc.Base64.parse(n.GLOBAL_IV.replace(/\$/g,"="));return n.CryptoJS.AES.encrypt(t,r,{iv:u}).toString()};PDS_Save=function(){var t={pipe:"",type:"generic_save_view_data*app="+PDS_AppName+'*objt={"escaped":"'+n.$$.Tool.Escape(JSON.stringify(PDS_TargetsToUpdate))+'"}*objg={"escaped":"'+n.$$.Tool.Escape(JSON.stringify(PDS_GroupsToUpdate))+'"}',uu:sessionStorage.userId,key:sessionStorage.sepk};$.when(n.GLOBAL_MAKE_PROMISE(t)).done(function(n){var i=f(n.result,sessionStorage.sepk),t=JSON.parse(i);typeof t.error=="undefined"?PDS_Save_Callback():alert("Error: "+t.error)}).fail(function(){PDS_Save_Callback()}).always(function(){$("#SaveDataOnAbility").disable(!1)})};e=!1;"indexedDB"in window&&(e=!0);typeof localStorage.debugMode!="string"&&(localStorage.debugMode="0");typeof localStorage["memoryVersion"+i+PDS_AppName]!="string"&&(localStorage["memoryVersion"+i+PDS_AppName]="0");typeof localStorage["targetVersion"+i+PDS_AppName]!="string"&&(localStorage["targetVersion"+i+PDS_AppName]="0");typeof localStorage["groupVersion"+i+PDS_AppName]!="string"&&(localStorage["groupVersion"+i+PDS_AppName]="0");e?localStorage.debugMode=="init"?(localStorage.debugMode="0",localStorage["memoryVersion"+i+PDS_AppName]="0",localStorage["targetVersion"+i+PDS_AppName]="0",localStorage["groupVersion"+i+PDS_AppName]="0"):localStorage.debugMode=="drop"?(u=indexedDB.deleteDatabase(PDS_AppName+i),u.onsuccess=function(){console.log("Deleted database successfully")},u.onerror=function(){console.log("Couldn't delete database")},u.onblocked=function(){console.log("Couldn't delete database due to the operation being blocked")},localStorage.debugMode="0",localStorage["memoryVersion"+i+PDS_AppName]="0",localStorage["targetVersion"+i+PDS_AppName]="0",localStorage["groupVersion"+i+PDS_AppName]="0",window.location.reload()):(r=indexedDB.open(PDS_AppName+i,1),r.onupgradeneeded=function(n){var t=n.target.result;t.objectStoreNames.contains("appMemory")||t.createObjectStore("appMemory");t.objectStoreNames.contains("appTarget")||t.createObjectStore("appTarget");

t.objectStoreNames.contains("appGroup")||t.createObjectStore("appGroup")},r.onsuccess=function(r){var u={pipe:"",type:"generic_get_view_data*app="+PDS_AppName+"*mv="+localStorage["memoryVersion"+i+PDS_AppName]+"*tv="+localStorage["targetVersion"+i+PDS_AppName]+"*gv="+localStorage["groupVersion"+i+PDS_AppName],uu:sessionStorage.userId,key:sessionStorage.sepk};

DF1=sessionStorage.sepk;

PDS_StartOTCRequest();

PDS_Mode=="realtime"?PDS_RealtimeHandler(u):$.when(n.GLOBAL_MAKE_PROMISE(u)).done(function(n){PDS_DoneOTCRequest();;;var u=f(n.result,DF1);localStorage.debugMode=="1"&&(console.log("Debug mode enabled"),PDS_DebugViewDataModel=u);PDS_ViewDataModel=JSON.parse(u.replaceAll("\\\\","\\"));s()?alert("Failed to get view data - view is in error state - "+PDS_ViewDataModel.error):t(r.target.result,PDS_AppName,i)}).fail(function(){PDS_FailedRequest()})},r.onerror=function(n){alert("IndexedDB error event raised!");console.log("Error");console.dir(n)},r.onblocked=function(n){alert("IndexedDB Blocked event raised!");console.log("Error");console.dir(n)}):alert("IndexedDB is not supported on this browser - application has stopped")},n=document.getElementById(PDS_PipeName).contentWindow,r=setInterval(function(){if(typeof n.GLOBAL_RECONFIGURE_PROMISE=="function"){if(typeof sessionStorage.sepk=="string"&&sessionStorage.sepk!=="0"){var t={pipe:"",type:"",uu:sessionStorage.userId,key:sessionStorage.sepk};n.GLOBAL_RECONFIGURE_PROMISE(t);PDS_Override=="true"&&(n.GLOBAL_NETWORK_OP_MONITOR_INTERVAL=3500,n.GLOBAL_LONG_PROCESSING_NETWORK_OPERATION_HANDLER=function(n,t,i){typeof t!="undefined"&&typeof t.EXCEPTION!="undefined"&&t.EXCEPTION=="security broken - user deleted/expired"&&(localStorage.userId="0",localStorage.sepk="0",alert("Communication non authorized"));t.readyState!==4&&(t.abort(),i.reject(),UPDATE_ACTIVE=0,clearInterval(n))},UPDATE_ACTIVE=1);i()}clearInterval(r)}},500)}})(PDS_App||(PDS_App={}));